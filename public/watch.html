<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ø¨Ø« Ù…Ø¨Ø§Ø´Ø±</title>
    <link rel="preload" href="assets/fonts/Cairo-Bold.ttf" as="font" type="font/ttf" crossorigin>

    <script src="/js/config.js"></script>

    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <link rel="canonical" href="https://livematch-991.pages.dev/watch.html">

    <link rel="stylesheet" href="/css/watch.css">

    <!-- Adexium In-page Script (PAUSED)
    <script type="text/javascript" src="https://cdn.atechp.space/assets/js/inp.min.js"></script>
    <script type="text/javascript">
        document.addEventListener('DOMContentLoaded', () => {
            const adexiumInpage = new AdexiumInpageWidget({ wid: 'ee8ca344-81f7-468e-aec8-4b35fca66433' });
            adexiumInpage.autoMode();
        });
    </script>
    -->

    <!-- Adcash Autotag -->
    <script id="aclib" type="text/javascript" src="//acscdn.com/script/aclib.js"></script>
    <script type="text/javascript">
        aclib.runAutoTag({
            zoneId: '3wrjllzmx7',
        });
    </script>
</head>

<body>
    <!-- Main Player Layout -->
    <div id="stream-container">
        <!-- Video takes mostly all space -->
        <div class="video-player-frame">
            <iframe id="stream" allowfullscreen referrerpolicy="no-referrer"
                allow="autoplay; encrypted-media; fullscreen; picture-in-picture"
                sandbox="allow-scripts allow-same-origin allow-forms allow-presentation"></iframe>
        </div>
    </div>

    <!-- Compact Bottom Controls -->
    <div class="watch-controls-center">
        <div class="control-card">
            <button onclick="window.location.href='/'" class="control-btn">
                <span class="icon">ğŸ </span>
                <span>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
            </button>
            <button onclick="toggleFullscreen()" class="control-btn">
                <span class="icon">â›¶</span>
                <span>Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø©</span>
            </button>
        </div>
    </div>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const matchId = urlParams.get('match');
        const selectedServerIdx = urlParams.get('server');
        let currentMatch = null;

        // Toggle Fullscreen for the Wrapper
        function toggleFullscreen() {
            const el = document.querySelector('.video-player-frame');
            if (!document.fullscreenElement) {
                if (el.requestFullscreen) el.requestFullscreen();
                else if (el.webkitRequestFullscreen) el.webkitRequestFullscreen();
            } else {
                if (document.exitFullscreen) document.exitFullscreen();
            }
        }

        async function init() {
            try {
                const res = await fetch(`data/matches.json?t=${Date.now()}`, { cache: 'no-store' });
                const data = await res.json();
                currentMatch = data.matches.find(m => m.id == matchId);

                if (!currentMatch) return showError('Ø§Ù„Ø¨Ø« Ø§Ù„Ù…Ø¨Ø§Ø´Ø± Ø§Ù†ØªÙ‡Ù‰ Ø£Ùˆ ØºÙŠØ± Ù…ØªÙˆÙØ±');

                if (selectedServerIdx !== null && currentMatch.streams[selectedServerIdx]) {
                    launchStream(currentMatch.streams[selectedServerIdx].url);
                } else {
                    showError('Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø³ÙŠØ±ÙØ± ØµØ§Ù„Ø­');
                }
            } catch (e) { showError('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…'); }
        }

        function launchStream(url) {
            const cont = document.getElementById('stream-container');
            const frame = document.getElementById('stream');
            cont.style.display = 'flex';
            frame.src = url;
        }

        function showError(msg) {
            document.body.innerHTML = `<div style="display:flex; flex-direction:column; align-items:center; justify-content:center; height:100dvh; background:#000; text-align:center;">
                <h2 style="color:#fff; margin-bottom:20px;">âš ï¸ ${msg}</h2>
                <a href="/" style="color:#667eea; font-weight:bold; text-decoration:none; font-size:1.2rem;">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
            </div>`;
        }

        init();
    </script>
</body>

</html>